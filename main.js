(()=>{"use strict";function e(e,t){if(e<t-1&&e>0)return"top";if(e<t**2-1&&e>t**2-t)return"bottom";for(let l=1;l<t-1;l+=1){if(e===t*l)return"left";if(e===t*l+(t-1))return"right"}switch(e){case 0:return"top-left";case t-1:return"top-right";case t*(t-1):return"bottom-left";case t**2-1:return"bottom-right";default:return"center"}}function t(e){const t=function(e){const t=[];for(let l=0;l<e**2;l+=8)t.push(l),t.push(l+1);return t}(e);return t[Math.floor(Math.random()*t.length)]}const l={auto:"auto",pointer:"pointer",crosshair:"crosshair",notallowed:"not-allowed"};console.log("it works!");const s=new class{constructor(e){this.boardSize=e,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const l=document.createElement("div");l.classList.add("cell","map-tile",`map-tile-${e(t,this.boardSize)}`),l.addEventListener("mouseenter",(e=>this.onCellEnter(e))),l.addEventListener("mouseleave",(e=>this.onCellLeave(e))),l.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(l)}this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";const t=this.boardEl.children[e],l=document.createElement("div");l.classList.add("character","generic"),t.appendChild(l)}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((e=>e.call(null,t)))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((e=>e.call(null,t)))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}selectCell(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red";this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`)}deselectCell(e){const t=this.cells[e];t.classList.remove(...Array.from(t.classList).filter((e=>e.startsWith("selected"))))}showCellTooltip(e,t){this.cells[t].title=e}hideCellTooltip(e){this.cells[e].title=""}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}(4);s.bindToDOM(document.querySelector("#game-container"));const i=new class{constructor(e){this.gamePlay=e,this.indexSelect={},this.onCellClick=this.onCellClick.bind(this),this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this)}init(){this.events(),this.gamePlay.drawUi("prairie"),this.showCharacter()}events(){this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick)}onCellClick(e){this.gamePlay.setCursor(l.crosshair),document.querySelector(".selected-red")&&this.gamePlay.deselectCell(this.indexSelect.red),this.gamePlay.selectCell(e),this.indexSelect.red=e}onCellEnter(){this.gamePlay.setCursor(l.pointer)}onCellLeave(e){this.gamePlay.hideCellTooltip(e)}showCharacter(){const e=setInterval((()=>{let e,l=!1;do{e=t(this.gamePlay.boardSize),this.gamePlay.positionChar===e&&(e=t(this.gamePlay.boardSize),l=!0),this.gamePlay.positionChar=e}while(!l);this.gamePlay.redrawPositions(e)}),1e3);setTimeout((()=>clearInterval(e)),1e6)}}(s);i.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Zm5FLEtBQUtGLFNBQVNzRSxhQUFldkMsU0FDckJzQyxHQUNWbkUsS0FBS0YsU0FBUzhCLGdCQUFnQkMsRUFBUyxHQUN0QyxLQUNId0MsWUFBVyxJQUFNQyxjQUFjTCxJQUFVLElBQzNDLEdGakRrQ25FLEdBQ3BDMkQsRUFBU0csTSIsInNvdXJjZXMiOlsid2VicGFjazovL2Foai1ob21ld29yay1kb20vLi9zcmMvanMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vYWhqLWhvbWV3b3JrLWRvbS8uL3NyYy9qcy9jcmVhdGVQb3NpdGlvbi5qcyIsIndlYnBhY2s6Ly9haGotaG9tZXdvcmstZG9tLy4vc3JjL2pzL2N1cnNvcnMuanMiLCJ3ZWJwYWNrOi8vYWhqLWhvbWV3b3JrLWRvbS8uL3NyYy9qcy9hcHAuanMiLCJ3ZWJwYWNrOi8vYWhqLWhvbWV3b3JrLWRvbS8uL3NyYy9qcy9HYW1lUGxheS5qcyIsIndlYnBhY2s6Ly9haGotaG9tZXdvcmstZG9tLy4vc3JjL2pzL0dhbWVDb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNhbGNUaWxlVHlwZShpbmRleCwgYm9hcmRTaXplKSB7XG4gIC8vIFRPRE86INCy0LDRiCDQutC+0LQg0LHRg9C00LXRgiDRgtGD0YJcbiAgaWYgKGluZGV4IDwgKGJvYXJkU2l6ZSAtIDEpICYmIGluZGV4ID4gMCkge1xuICAgIHJldHVybiAndG9wJztcbiAgfVxuICBpZiAoaW5kZXggPCAoYm9hcmRTaXplICoqIDIgLSAxKSAmJiBpbmRleCA+IChib2FyZFNpemUgKiogMiAtIGJvYXJkU2l6ZSkpIHtcbiAgICByZXR1cm4gJ2JvdHRvbSc7XG4gIH1cbiAgZm9yIChsZXQgaSA9IDE7IGkgPCBib2FyZFNpemUgLSAxOyBpICs9IDEpIHtcbiAgICBpZiAoaW5kZXggPT09IGJvYXJkU2l6ZSAqIGkpIHtcbiAgICAgIHJldHVybiAnbGVmdCc7XG4gICAgfVxuICAgIGlmIChpbmRleCA9PT0gKGJvYXJkU2l6ZSAqIGkgKyAoYm9hcmRTaXplIC0gMSkpKSB7XG4gICAgICByZXR1cm4gJ3JpZ2h0JztcbiAgICB9XG4gIH1cblxuICBzd2l0Y2ggKGluZGV4KSB7XG4gICAgY2FzZSAwOlxuICAgICAgcmV0dXJuICd0b3AtbGVmdCc7XG4gICAgY2FzZSAoYm9hcmRTaXplIC0gMSk6XG4gICAgICByZXR1cm4gJ3RvcC1yaWdodCc7XG4gICAgY2FzZSAoYm9hcmRTaXplICogKGJvYXJkU2l6ZSAtIDEpKTpcbiAgICAgIHJldHVybiAnYm90dG9tLWxlZnQnO1xuICAgIGNhc2UgKGJvYXJkU2l6ZSAqKiAyIC0gMSk6XG4gICAgICByZXR1cm4gJ2JvdHRvbS1yaWdodCc7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiAnY2VudGVyJztcbiAgfVxufVxuIiwiZnVuY3Rpb24gY3JlYXRBcnJheVBvc2l0aW9ucyhib2FyZFNpemUpIHtcbiAgY29uc3QgY2VsbHMgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZFNpemUgKiogMjsgaSArPSA4KSB7XG4gICAgY2VsbHMucHVzaChpKTtcbiAgICBjZWxscy5wdXNoKGkgKyAxKTtcbiAgfVxuICByZXR1cm4gY2VsbHM7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uKGJvYXJkU2l6ZSkge1xuICBjb25zdCBjZWxscyA9IGNyZWF0QXJyYXlQb3NpdGlvbnMoYm9hcmRTaXplKTtcbiAgY29uc3QgcmFuZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNlbGxzLmxlbmd0aCk7XG4gIHJldHVybiBjZWxsc1tyYW5kXTtcbn1cbiIsImNvbnN0IGN1cnNvcnMgPSB7XG4gIGF1dG86ICdhdXRvJyxcbiAgcG9pbnRlcjogJ3BvaW50ZXInLFxuICBjcm9zc2hhaXI6ICdjcm9zc2hhaXInLFxuICBub3RhbGxvd2VkOiAnbm90LWFsbG93ZWQnLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY3Vyc29ycztcbiIsImltcG9ydCBHYW1lUGxheSBmcm9tICcuL0dhbWVQbGF5JztcbmltcG9ydCBHYW1lQ29udHJvbGxlciBmcm9tICcuL0dhbWVDb250cm9sbGVyJztcblxuLyogZXNsaW50LWRpc2FibGUgKi9cbmNvbnNvbGUubG9nKCdpdCB3b3JrcyEnKTtcblxuY29uc3QgZ2FtZVBsYXkgPSBuZXcgR2FtZVBsYXkoNCk7XG5nYW1lUGxheS5iaW5kVG9ET00oZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dhbWUtY29udGFpbmVyJykpO1xuXG5jb25zdCBnYW1lQ3RybCA9IG5ldyBHYW1lQ29udHJvbGxlcihnYW1lUGxheSk7XG5nYW1lQ3RybC5pbml0KCk7IiwiaW1wb3J0IGNhbGNUaWxlVHlwZSBmcm9tICcuL3V0aWxzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZVBsYXkge1xuICBjb25zdHJ1Y3Rvcihib2FyZFNpemUpIHtcbiAgICB0aGlzLmJvYXJkU2l6ZSA9IGJvYXJkU2l6ZTtcbiAgICB0aGlzLmNvbnRhaW5lciA9IG51bGw7XG4gICAgdGhpcy5ib2FyZEVsID0gbnVsbDtcbiAgICB0aGlzLmNlbGxzID0gW107XG4gICAgdGhpcy5jZWxsQ2xpY2tMaXN0ZW5lcnMgPSBbXTtcbiAgICB0aGlzLmNlbGxFbnRlckxpc3RlbmVycyA9IFtdO1xuICAgIHRoaXMuY2VsbExlYXZlTGlzdGVuZXJzID0gW107XG4gIH1cblxuICBiaW5kVG9ET00oY29udGFpbmVyKSB7XG4gICAgaWYgKCEoY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbnRhaW5lciBpcyBub3QgSFRNTEVsZW1lbnQnKTtcbiAgICB9XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gIH1cblxuICBkcmF3VWkodGhlbWUpIHtcbiAgICB0aGlzLmNoZWNrQmluZGluZygpO1xuXG4gICAgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cImJvYXJkLWNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGRhdGEtaWQ9XCJib2FyZFwiIGNsYXNzPVwiYm9hcmRcIj48L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICB0aGlzLmJvYXJkRWwgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1ib2FyZF0nKTtcblxuICAgIHRoaXMuYm9hcmRFbC5jbGFzc0xpc3QuYWRkKHRoZW1lKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm9hcmRTaXplICoqIDI7IGkgKz0gMSkge1xuICAgICAgY29uc3QgY2VsbEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBjZWxsRWwuY2xhc3NMaXN0LmFkZCgnY2VsbCcsICdtYXAtdGlsZScsIGBtYXAtdGlsZS0ke2NhbGNUaWxlVHlwZShpLCB0aGlzLmJvYXJkU2l6ZSl9YCk7XG4gICAgICBjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChldmVudCkgPT4gdGhpcy5vbkNlbGxFbnRlcihldmVudCkpO1xuICAgICAgY2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoZXZlbnQpID0+IHRoaXMub25DZWxsTGVhdmUoZXZlbnQpKTtcbiAgICAgIGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gdGhpcy5vbkNlbGxDbGljayhldmVudCkpO1xuICAgICAgdGhpcy5ib2FyZEVsLmFwcGVuZENoaWxkKGNlbGxFbCk7XG4gICAgfVxuXG4gICAgdGhpcy5jZWxscyA9IEFycmF5LmZyb20odGhpcy5ib2FyZEVsLmNoaWxkcmVuKTtcbiAgfVxuXG4gIHJlZHJhd1Bvc2l0aW9ucyhwb3NpdGlvbikge1xuICAgIGZvciAoY29uc3QgY2VsbCBvZiB0aGlzLmNlbGxzKSB7XG4gICAgICBjZWxsLmlubmVySFRNTCA9ICcnO1xuICAgIH1cblxuICAgIGNvbnN0IGNlbGxFbCA9IHRoaXMuYm9hcmRFbC5jaGlsZHJlbltwb3NpdGlvbl07XG4gICAgY29uc3QgY2hhckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2hhckVsLmNsYXNzTGlzdC5hZGQoJ2NoYXJhY3RlcicsICdnZW5lcmljJyk7XG5cbiAgICBjZWxsRWwuYXBwZW5kQ2hpbGQoY2hhckVsKTtcbiAgfVxuXG4gIGFkZENlbGxFbnRlckxpc3RlbmVyKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jZWxsRW50ZXJMaXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XG4gIH1cblxuICBhZGRDZWxsTGVhdmVMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuY2VsbExlYXZlTGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xuICB9XG5cbiAgYWRkQ2VsbENsaWNrTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNlbGxDbGlja0xpc3RlbmVycy5wdXNoKGNhbGxiYWNrKTtcbiAgfVxuXG4gIG9uQ2VsbEVudGVyKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLmNlbGxFbnRlckxpc3RlbmVycy5mb3JFYWNoKChvKSA9PiBvLmNhbGwobnVsbCwgaW5kZXgpKTtcbiAgfVxuXG4gIG9uQ2VsbExlYXZlKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLmNlbGxMZWF2ZUxpc3RlbmVycy5mb3JFYWNoKChvKSA9PiBvLmNhbGwobnVsbCwgaW5kZXgpKTtcbiAgfVxuXG4gIG9uQ2VsbENsaWNrKGV2ZW50KSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgdGhpcy5jZWxsQ2xpY2tMaXN0ZW5lcnMuZm9yRWFjaCgobykgPT4gby5jYWxsKG51bGwsIGluZGV4KSk7XG4gIH1cblxuICBzZWxlY3RDZWxsKGluZGV4LCBjb2xvciA9ICdyZWQnKSB7XG4gICAgdGhpcy5kZXNlbGVjdENlbGwoaW5kZXgpO1xuICAgIHRoaXMuY2VsbHNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJywgYHNlbGVjdGVkLSR7Y29sb3J9YCk7XG4gIH1cblxuICBkZXNlbGVjdENlbGwoaW5kZXgpIHtcbiAgICBjb25zdCBjZWxsID0gdGhpcy5jZWxsc1tpbmRleF07XG4gICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKC4uLkFycmF5LmZyb20oY2VsbC5jbGFzc0xpc3QpXG4gICAgICAuZmlsdGVyKChvKSA9PiBvLnN0YXJ0c1dpdGgoJ3NlbGVjdGVkJykpKTtcbiAgfVxuXG4gIHNob3dDZWxsVG9vbHRpcChtZXNzYWdlLCBpbmRleCkge1xuICAgIHRoaXMuY2VsbHNbaW5kZXhdLnRpdGxlID0gbWVzc2FnZTtcbiAgfVxuXG4gIGhpZGVDZWxsVG9vbHRpcChpbmRleCkge1xuICAgIHRoaXMuY2VsbHNbaW5kZXhdLnRpdGxlID0gJyc7XG4gIH1cblxuICBzZXRDdXJzb3IoY3Vyc29yKSB7XG4gICAgdGhpcy5ib2FyZEVsLnN0eWxlLmN1cnNvciA9IGN1cnNvcjtcbiAgfVxuXG4gIGNoZWNrQmluZGluZygpIHtcbiAgICBpZiAodGhpcy5jb250YWluZXIgPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignR2FtZVBsYXkgbm90IGJpbmQgdG8gRE9NJyk7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgY3JlYXRlUG9zaXRpb24gZnJvbSAnLi9jcmVhdGVQb3NpdGlvbic7XG5pbXBvcnQgY3Vyc29ycyBmcm9tICcuL2N1cnNvcnMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKGdhbWVQbGF5KSB7XG4gICAgdGhpcy5nYW1lUGxheSA9IGdhbWVQbGF5O1xuICAgIHRoaXMuaW5kZXhTZWxlY3QgPSB7fTtcbiAgICB0aGlzLm9uQ2VsbENsaWNrID0gdGhpcy5vbkNlbGxDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DZWxsRW50ZXIgPSB0aGlzLm9uQ2VsbEVudGVyLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNlbGxMZWF2ZSA9IHRoaXMub25DZWxsTGVhdmUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgLy8gVE9ETzogYWRkIGV2ZW50IGxpc3RlbmVycyB0byBnYW1lUGxheSBldmVudHNcbiAgICB0aGlzLmV2ZW50cygpO1xuICAgIHRoaXMuZ2FtZVBsYXkuZHJhd1VpKCdwcmFpcmllJyk7XG4gICAgdGhpcy5zaG93Q2hhcmFjdGVyKCk7XG4gIH1cblxuICBldmVudHMoKSB7XG4gICAgdGhpcy5nYW1lUGxheS5hZGRDZWxsRW50ZXJMaXN0ZW5lcih0aGlzLm9uQ2VsbEVudGVyKTtcbiAgICB0aGlzLmdhbWVQbGF5LmFkZENlbGxMZWF2ZUxpc3RlbmVyKHRoaXMub25DZWxsTGVhdmUpO1xuICAgIHRoaXMuZ2FtZVBsYXkuYWRkQ2VsbENsaWNrTGlzdGVuZXIodGhpcy5vbkNlbGxDbGljayk7XG4gIH1cblxuICBvbkNlbGxDbGljayhpbmRleCkge1xuICAgIHRoaXMuZ2FtZVBsYXkuc2V0Q3Vyc29yKGN1cnNvcnMuY3Jvc3NoYWlyKTtcbiAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlbGVjdGVkLXJlZCcpKSB7XG4gICAgICB0aGlzLmdhbWVQbGF5LmRlc2VsZWN0Q2VsbCh0aGlzLmluZGV4U2VsZWN0LnJlZCk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lUGxheS5zZWxlY3RDZWxsKGluZGV4KTtcbiAgICB0aGlzLmluZGV4U2VsZWN0LnJlZCA9IGluZGV4O1xuICB9XG5cbiAgb25DZWxsRW50ZXIoKSB7XG4gICAgdGhpcy5nYW1lUGxheS5zZXRDdXJzb3IoY3Vyc29ycy5wb2ludGVyKTtcbiAgfVxuXG4gIG9uQ2VsbExlYXZlKGluZGV4KSB7XG4gICAgdGhpcy5nYW1lUGxheS5oaWRlQ2VsbFRvb2x0aXAoaW5kZXgpO1xuICB9XG5cbiAgc2hvd0NoYXJhY3RlcigpIHtcbiAgICBjb25zdCB0aW1lcklkID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgbGV0IHBvc2l0aW9uO1xuICAgICAgbGV0IGlzUG9zaXRpb24gPSBmYWxzZTtcbiAgICAgIGRvIHtcbiAgICAgICAgcG9zaXRpb24gPSBjcmVhdGVQb3NpdGlvbih0aGlzLmdhbWVQbGF5LmJvYXJkU2l6ZSk7XG4gICAgICAgIGlmICh0aGlzLmdhbWVQbGF5LnBvc2l0aW9uQ2hhciA9PT0gcG9zaXRpb24pIHtcbiAgICAgICAgICBwb3NpdGlvbiA9IGNyZWF0ZVBvc2l0aW9uKHRoaXMuZ2FtZVBsYXkuYm9hcmRTaXplKTtcbiAgICAgICAgICBpc1Bvc2l0aW9uID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdhbWVQbGF5LnBvc2l0aW9uQ2hhciA9IHBvc2l0aW9uO1xuICAgICAgfSB3aGlsZSAoIWlzUG9zaXRpb24pO1xuICAgICAgdGhpcy5nYW1lUGxheS5yZWRyYXdQb3NpdGlvbnMocG9zaXRpb24pO1xuICAgIH0sIDEwMDApO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gY2xlYXJJbnRlcnZhbCh0aW1lcklkKSwgMTAwMDAwMCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJjYWxjVGlsZVR5cGUiLCJpbmRleCIsImJvYXJkU2l6ZSIsImkiLCJjcmVhdGVQb3NpdGlvbiIsImNlbGxzIiwicHVzaCIsImNyZWF0QXJyYXlQb3NpdGlvbnMiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJsZW5ndGgiLCJhdXRvIiwicG9pbnRlciIsImNyb3NzaGFpciIsIm5vdGFsbG93ZWQiLCJjb25zb2xlIiwibG9nIiwiZ2FtZVBsYXkiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJjb250YWluZXIiLCJib2FyZEVsIiwiY2VsbENsaWNrTGlzdGVuZXJzIiwiY2VsbEVudGVyTGlzdGVuZXJzIiwiY2VsbExlYXZlTGlzdGVuZXJzIiwiYmluZFRvRE9NIiwiSFRNTEVsZW1lbnQiLCJFcnJvciIsImRyYXdVaSIsInRoZW1lIiwiY2hlY2tCaW5kaW5nIiwiaW5uZXJIVE1MIiwicXVlcnlTZWxlY3RvciIsImNsYXNzTGlzdCIsImFkZCIsImNlbGxFbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsIm9uQ2VsbEVudGVyIiwib25DZWxsTGVhdmUiLCJvbkNlbGxDbGljayIsImFwcGVuZENoaWxkIiwiQXJyYXkiLCJmcm9tIiwiY2hpbGRyZW4iLCJyZWRyYXdQb3NpdGlvbnMiLCJwb3NpdGlvbiIsImNlbGwiLCJjaGFyRWwiLCJhZGRDZWxsRW50ZXJMaXN0ZW5lciIsImNhbGxiYWNrIiwiYWRkQ2VsbExlYXZlTGlzdGVuZXIiLCJhZGRDZWxsQ2xpY2tMaXN0ZW5lciIsInByZXZlbnREZWZhdWx0IiwiaW5kZXhPZiIsImN1cnJlbnRUYXJnZXQiLCJmb3JFYWNoIiwibyIsImNhbGwiLCJzZWxlY3RDZWxsIiwiY29sb3IiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJkZXNlbGVjdENlbGwiLCJyZW1vdmUiLCJmaWx0ZXIiLCJzdGFydHNXaXRoIiwic2hvd0NlbGxUb29sdGlwIiwibWVzc2FnZSIsInRpdGxlIiwiaGlkZUNlbGxUb29sdGlwIiwic2V0Q3Vyc29yIiwiY3Vyc29yIiwic3R5bGUiLCJnYW1lQ3RybCIsImluZGV4U2VsZWN0IiwiYmluZCIsImluaXQiLCJldmVudHMiLCJzaG93Q2hhcmFjdGVyIiwiY3Vyc29ycyIsInJlZCIsInRpbWVySWQiLCJzZXRJbnRlcnZhbCIsImlzUG9zaXRpb24iLCJwb3NpdGlvbkNoYXIiLCJzZXRUaW1lb3V0IiwiY2xlYXJJbnRlcnZhbCJdLCJzb3VyY2VSb290IjoiIn0=